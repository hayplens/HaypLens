<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
<head>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7617423662199092"
     crossorigin="anonymous"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>CoinLens – Canlı Kripto Piyasası</title>
  <meta name="description" content="Canlı kripto verileri, piyasa tablosu, gerçek zamanlı grafik ve reklam alanları ile profesyonel kripto takip sitesi." />

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>CoinLens – Canlı Kripto Piyasası</title>
  <meta name="description" content="Canlı kripto verileri, piyasa tablosu, gerçek zamanlı grafik ve reklam alanları ile profesyonel kripto takip sitesi." />

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config: brand colors
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: {
              50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',
              500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'
            }
          },
          boxShadow:{
            glow: '0 0 0 3px rgba(99,102,241,0.35)',
          },
          keyframes:{
            pulseGlow:{
              '0%,100%':{boxShadow:'0 0 0 0 rgba(99,102,241,0.0)'},
              '50%':{boxShadow:'0 0 0 8px rgba(99,102,241,0.15)'}
            },
            tickUp:{'0%':{background:'rgba(34,197,94,0.12)'},'100%':{background:'transparent'}},
            tickDown:{'0%':{background:'rgba(239,68,68,0.12)'},'100%':{background:'transparent'}},
            shimmer:{'0%':{backgroundPosition:'-500px 0'},'100%':{backgroundPosition:'500px 0'}},
          },
          animation:{
            pulseGlow:'pulseGlow 1.8s ease-in-out',
            tickUp:'tickUp 1s ease-out',
            tickDown:'tickDown 1s ease-out',
            shimmer:'shimmer 1.8s linear infinite',
          }
        }
      }
    }
  </script>

  <!-- Icons -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --card: rgba(255,255,255,0.7); --card-dark: rgba(15, 23, 42, 0.8); }
    html { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Apple Color Emoji','Segoe UI Emoji'; }
    /* Nice gradient background */
    .bg-grid { background-image: radial-gradient(rgba(99,102,241,0.12) 1px, transparent 1px); background-size: 24px 24px; }
    .gradient-hero { background: radial-gradient(1200px 600px at 0% 0%, rgba(99,102,241,.15), transparent),
                                  radial-gradient(1000px 500px at 100% 0%, rgba(56,189,248,.12), transparent); }
    .tv-container iframe { border-radius: 1rem; }
    .skeleton { background: linear-gradient(90deg, rgba(148,163,184,0.15) 25%, rgba(148,163,184,0.3) 37%, rgba(148,163,184,0.15) 63%); background-size: 400% 100%; }
  </style>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <!-- TradingView (optional toggle) -->
  <script src="https://s3.tradingview.com/tv.js"></script>
</head>
<body class="min-h-screen bg-slate-50 dark:bg-slate-950 text-slate-800 dark:text-slate-100 gradient-hero">
  <!-- Theme bootstrap -->
  <script>
    (function(){
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if((!saved && prefersDark) || saved === 'dark') document.documentElement.classList.add('dark');
    })();
  </script>

  <!-- Top bar -->
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-slate-900/60 border-b border-slate-200/70 dark:border-slate-800/70">
    <div class="mx-auto max-w-7xl px-3 sm:px-6 py-3 flex items-center gap-3">
      <div class="flex items-center gap-2 group">
        <div class="h-9 w-9 rounded-2xl bg-gradient-to-br from-brand-500 to-cyan-400 shadow-glow animate-pulseGlow"></div>
        <span class="text-xl font-extrabold tracking-tight"><span class="text-brand-600 dark:text-brand-400">HaypLens</span></span>
      </div>
      <div class="ml-4 hidden md:flex items-center gap-2 flex-1">
        <input id="search" type="text" placeholder="Coin ara (BTC, ETH, SOL...)" class="w-full md:w-96 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/70 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand-500" />
        <button id="clearSearch" class="px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 hover:bg-slate-100 dark:hover:bg-slate-800">Temizle</button>
      </div>
      <div class="ml-auto flex items-center gap-2">
        <span id="lastUpdated" class="text-xs text-slate-500 dark:text-slate-400 hidden sm:block">—</span>
        <button id="themeToggle" class="p-2 rounded-xl border border-slate-200 dark:border-slate-800 hover:shadow-glow" title="Tema değiştir">
          <svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5 hidden dark:block"><path fill="currentColor" d="M6.76 4.84l-1.8-1.79L3.17 4.85l1.79 1.79zm10.45 14.32l1.79 1.79l1.79-1.79l-1.79-1.79zM12 4V1h0v3zm0 19v-3h0v3zM4 12H1v0h3zm22 0h-3v0h3zM6.76 19.16l-1.8 1.79l1.79 1.79l1.79-1.79zM19.16 6.76l1.79-1.79l-1.79-1.79l-1.79 1.79zM12 8a4 4 0 100 8a4 4 0 000-8z"/></svg>
          <svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5 dark:hidden"><path fill="currentColor" d="M12 2a9.93 9.93 0 00-3.16.51A10 10 0 1012 2z"/></svg>
        </button>
        <button id="manualRefresh" class="px-3 py-2 rounded-xl bg-brand-600 hover:bg-brand-700 text-white text-sm">Yenile</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-3 sm:px-6 py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Left Ads -->
    <aside class="hidden lg:block lg:col-span-2 space-y-4">
      <!-- Google Ads Placeholder -->
      <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800">
        <div class="text-xs text-slate-500 mb-2">Reklam</div>
        <div class="h-60 rounded-xl skeleton animate-shimmer"></div>
        <!-- Google Ads script example (commented)
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=YOUR-ADSENSE-ID" crossorigin="anonymous"></script>
        <ins class="adsbygoogle" style="display:block" data-ad-client="YOUR-ADSENSE-ID" data-ad-slot="123456" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> -->
      </div>
      <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800">
        <div class="text-xs text-slate-500 mb-2">Reklam</div>
        <div class="h-80 rounded-xl skeleton animate-shimmer"></div>
      </div>
    </aside>

    <!-- Center Content -->
    <section class="lg:col-span-8 space-y-6">
      <!-- KPI Cards -->
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800 hover:shadow-lg transition-shadow" id="kpi-marketcap">
          <div class="text-xs text-slate-500">Toplam Market Cap</div>
          <div class="text-2xl font-bold mt-1" id="totalMarketCap">—</div>
          <div class="text-xs mt-1" id="totalMarketCapChange"></div>
        </div>
        <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800 hover:shadow-lg" id="kpi-volume">
          <div class="text-xs text-slate-500">24s Hacim</div>
          <div class="text-2xl font-bold mt-1" id="totalVolume">—</div>
          <div class="text-xs mt-1" id="totalVolumeNote">USD</div>
        </div>
        <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800 hover:shadow-lg" id="kpi-btc-dom">
          <div class="text-xs text-slate-500">BTC Dominance</div>
          <div class="text-2xl font-bold mt-1" id="btcDominance">—</div>
          <div class="text-xs mt-1">Piyasa Payı</div>
        </div>
        <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800 hover:shadow-lg" id="kpi-update">
          <div class="text-xs text-slate-500">Güncelleme</div>
          <div class="text-2xl font-bold mt-1" id="updateCountdown">10s</div>
          <div class="text-xs mt-1">Otomatik yenileme</div>
        </div>
      </div>

      <!-- Chart Area with toggle -->
      <div class="rounded-2xl p-4 sm:p-6 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800">
        <div class="flex flex-col sm:flex-row sm:items-center gap-3">
          <div class="flex items-center gap-2 flex-1">
            <label class="text-sm text-slate-500">Grafik:</label>
            <select id="chartCoin" class="rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-3 py-2">
              <option value="bitcoin" selected>Bitcoin (BTC)</option>
              <option value="ethereum">Ethereum (ETH)</option>
              <option value="binancecoin">BNB (BNB)</option>
              <option value="solana">Solana (SOL)</option>
              <option value="ripple">XRP (XRP)</option>
              <option value="dogecoin">Dogecoin (DOGE)</option>
            </select>
            <select id="daysSelect" class="rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-3 py-2">
              <option value="1">1G</option>
              <option value="7">7G</option>
              <option value="30">30G</option>
              <option value="90">90G</option>
              <option value="365">1Y</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <button id="chartModeJS" class="px-3 py-2 rounded-xl text-sm bg-brand-600 text-white hover:bg-brand-700">Chart.js</button>
            <button id="chartModeTV" class="px-3 py-2 rounded-xl text-sm border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800">TradingView</button>
          </div>
        </div>
        <div class="mt-4">
          <div id="chartJsWrap" class="block">
            <canvas id="priceChart" height="120"></canvas>
          </div>
          <div id="tvWrap" class="hidden tv-container">
            <div id="tradingview_widget" class="w-full h-[480px]"></div>
          </div>
        </div>
      </div>

      <!-- Markets Table -->
      <div class="rounded-2xl overflow-hidden bg-white/80 dark:bg-slate-900/80 border border-slate-200 dark:border-slate-800">
        <div class="p-4 flex items-center justify-between">
          <h2 class="text-lg font-semibold">Piyasa Tablosu</h2>
          <div class="text-sm text-slate-500" id="tableInfo">Top 50</div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-slate-100/80 dark:bg-slate-800/60 text-slate-600 dark:text-slate-300">
              <tr>
                <th class="text-left px-4 py-3">#</th>
                <th class="text-left px-4 py-3">Coin</th>
                <th class="text-right px-4 py-3">Fiyat</th>
                <th class="text-right px-4 py-3">24s %</th>
                <th class="text-right px-4 py-3">Market Cap</th>
                <th class="text-right px-4 py-3">Hacim (24s)</th>
              </tr>
            </thead>
            <tbody id="marketBody" class="divide-y divide-slate-200/70 dark:divide-slate-800/70">
              <!-- Rows injected here -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Right Ads -->
    <aside class="hidden lg:block lg:col-span-2 space-y-4">
      <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800">
        <div class="text-xs text-slate-500 mb-2">Reklam</div>
        <div class="h-60 rounded-xl skeleton animate-shimmer"></div>
      </div>
      <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800">
        <div class="text-xs text-slate-500 mb-2">Reklam</div>
        <div class="h-80 rounded-xl skeleton animate-shimmer"></div>
      </div>
    </aside>

    <!-- Mobile Ads -->
    <div class="lg:hidden space-y-4">
      <div class="rounded-2xl p-4 bg-white/70 dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800">
        <div class="text-xs text-slate-500 mb-2">Reklam</div>
        <div class="h-32 rounded-xl skeleton animate-shimmer"></div>
      </div>
    </div>
  </main>

  <footer class="mx-auto max-w-7xl px-3 sm:px-6 py-8 text-xs text-slate-500">
    © <span id="year"></span> HaypLens—  Veriler CoinGecko genel API üzerinden çekilir. 10 saniyede bir güncellenir.
  </footer>

  <!-- App Script -->
  <script>
    const USE_BINANCE = false; // İsterseniz Binance entegrasyonu için genişletilebilir.
    const COINGECKO_BASE = 'https://api.coingecko.com/api/v3';
    const marketBody = document.getElementById('marketBody');
    const lastUpdatedEl = document.getElementById('lastUpdated');
    const updateCountdownEl = document.getElementById('updateCountdown');
    const totalMarketCapEl = document.getElementById('totalMarketCap');
    const totalMarketCapChangeEl = document.getElementById('totalMarketCapChange');
    const totalVolumeEl = document.getElementById('totalVolume');
    const btcDominanceEl = document.getElementById('btcDominance');
    const searchInput = document.getElementById('search');
    const clearBtn = document.getElementById('clearSearch');

    let countdown = 10;
    let intervalTimer = null;
    let priceChart = null;
    let lastPriceMap = new Map(); // id -> last price

    function fmtUSD(n,opts={}){ try{ return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',notation: opts.notation||'standard',maximumFractionDigits: opts.maxfd??2}).format(n);}catch{ return `$${n}`}}
    function fmtNum(n){ try{ return new Intl.NumberFormat('en-US',{maximumFractionDigits:0}).format(n);}catch{ return n}}
    function pct(n){ const sign = n>0?'+':''; return `${sign}${n?.toFixed(2)}%`; }
    function nowStr(){ const d=new Date(); return d.toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit',second:'2-digit'}); }

    async function fetchMarkets(){
      // 1) Global data for KPIs
      const gRes = await fetch(`${COINGECKO_BASE}/global`);
      const g = await gRes.json();
      const mcap = g.data?.total_market_cap?.usd ?? 0;
      const vol = g.data?.total_volume?.usd ?? 0;
      const btcDom = g.data?.market_cap_percentage?.btc ?? 0;
      totalMarketCapEl.textContent = fmtUSD(mcap, {notation:'compact'});
      totalVolumeEl.textContent = fmtUSD(vol, {notation:'compact'});
      btcDominanceEl.textContent = `${btcDom.toFixed(1)}%`;
      const mcapChange24 = g.data?.market_cap_change_percentage_24h_usd ?? 0;
      totalMarketCapChangeEl.innerHTML = (mcapChange24>=0)
        ? `<span class="text-emerald-600">▲ ${mcapChange24.toFixed(2)}%</span>`
        : `<span class="text-rose-600">▼ ${mcapChange24.toFixed(2)}%</span>`;

      // 2) Market list
      const res = await fetch(`${COINGECKO_BASE}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=false&price_change_percentage=24h`);
      const data = await res.json();
      renderTable(data);
      lastUpdatedEl.textContent = `Son güncelleme: ${nowStr()}`;
      // update chart if the coin in dropdown changed during first load
      const selected = document.getElementById('chartCoin').value;
      updateChart(selected, document.getElementById('daysSelect').value);
    }

    function renderTable(rows){
      const q = (searchInput?.value||'').trim().toLowerCase();
      marketBody.innerHTML = '';
      rows
        .filter(r=> !q || r.symbol.toLowerCase().includes(q) || r.name.toLowerCase().includes(q))
        .forEach((r,idx)=>{
          const tr = document.createElement('tr');
          const last = lastPriceMap.get(r.id);
          const priceChange = last===undefined ? null : (r.current_price - last);
          const animClass = priceChange==null? '' : (priceChange>0? 'animate-tickUp' : (priceChange<0? 'animate-tickDown' : ''));
          lastPriceMap.set(r.id, r.current_price);

          tr.innerHTML = `
            <td class="px-4 py-3">${r.market_cap_rank ?? idx+1}</td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-3">
                <img src="${r.image}" alt="${r.symbol}" class="h-6 w-6 rounded-full" loading="lazy" />
                <div>
                  <div class="font-medium">${r.name} <span class="text-xs text-slate-500">${r.symbol.toUpperCase()}</span></div>
                </div>
              </div>
            </td>
            <td class="px-4 py-3 text-right ${animClass}">
              <div class="inline-flex items-center justify-end gap-1">
                <span>${fmtUSD(r.current_price)}</span>
                ${priceChange==null? '' : (priceChange>0? '<span class="text-emerald-600">▲</span>' : (priceChange<0? '<span class="text-rose-600">▼</span>': ''))}
              </div>
            </td>
            <td class="px-4 py-3 text-right">${r.price_change_percentage_24h==null? '—' : (r.price_change_percentage_24h>=0
                ? `<span class='text-emerald-600'>${pct(r.price_change_percentage_24h)}</span>`
                : `<span class='text-rose-600'>${pct(r.price_change_percentage_24h)}</span>`)}
            </td>
            <td class="px-4 py-3 text-right">${fmtUSD(r.market_cap, {notation:'compact'})}</td>
            <td class="px-4 py-3 text-right">${fmtUSD(r.total_volume, {notation:'compact'})}</td>
          `;
          tr.addEventListener('mouseenter',()=> tr.classList.add('bg-slate-50/70','dark:bg-slate-800/40'));
          tr.addEventListener('mouseleave',()=> tr.classList.remove('bg-slate-50/70','dark:bg-slate-800/40'));
          tr.addEventListener('click',()=>{
            // On row click -> set chart coin
            document.getElementById('chartCoin').value = r.id;
            updateChart(r.id, document.getElementById('daysSelect').value);
            window.scrollTo({ top: 0, behavior: 'smooth'});
          });
          marketBody.appendChild(tr);
        });
    }

    async function updateChart(coinId, days){
      // Chart.js mode
      const chartWrap = document.getElementById('chartJsWrap');
      const tvWrap = document.getElementById('tvWrap');
      if(!tvWrap.classList.contains('hidden')){
        // refresh TradingView for selected coin
        loadTradingView(coinId);
      }
      try{
        const url = `${COINGECKO_BASE}/coins/${coinId}/market_chart?vs_currency=usd&days=${days}`;
        const res = await fetch(url);
        const data = await res.json();
        const labels = (data.prices||[]).map(p=> new Date(p[0]));
        const prices = (data.prices||[]).map(p=> p[1]);
        renderChart(labels, prices, coinId.toUpperCase());
      }catch(e){ console.error('Chart error', e); }
    }

    function renderChart(labels, prices, title){
      const ctx = document.getElementById('priceChart');
      const gradient = ctx.getContext('2d').createLinearGradient(0,0,0,200);
      gradient.addColorStop(0, 'rgba(99,102,241,0.35)');
      gradient.addColorStop(1, 'rgba(99,102,241,0.02)');
      if(priceChart) priceChart.destroy();
      priceChart = new Chart(ctx, {
        type:'line',
        data:{
          labels: labels.map(d=> d.toLocaleString('tr-TR', {hour:'2-digit', minute:'2-digit', day:'2-digit', month:'2-digit'})),
          datasets:[{
            label: 'Fiyat (USD)',
            data: prices,
            fill: true,
            backgroundColor: gradient,
            borderColor: 'rgba(99,102,241,1)',
            borderWidth: 2,
            pointRadius: 0,
            tension: 0.25,
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          interaction:{mode:'index', intersect:false},
          plugins:{
            legend:{display:false},
            tooltip:{callbacks:{label:(ctx)=> ` $${ctx.parsed.y.toLocaleString('en-US',{maximumFractionDigits:4})}`}}
          },
          scales:{
            x:{ ticks:{ maxTicksLimit: 8 }},
            y:{ ticks:{ callback:(v)=>'$'+Number(v).toLocaleString('en-US') }}
          }
        }
      });
    }

    function symbolToTradingView(coinId){
      // Simple mapper for common coins
      const map = { bitcoin:'BTCUSDT', ethereum:'ETHUSDT', binancecoin:'BNBUSDT', solana:'SOLUSDT', ripple:'XRPUSDT', dogecoin:'DOGEUSDT' };
      return map[coinId] || 'BTCUSDT';
    }

    function loadTradingView(coinId){
      const symbol = symbolToTradingView(coinId);
      if(typeof TradingView === 'undefined') return;
      document.getElementById('tradingview_widget').innerHTML = '';
      new TradingView.widget({
        autosize: true,
        symbol: `BINANCE:${symbol}`,
        interval: '60',
        timezone: 'Etc/UTC',
        theme: document.documentElement.classList.contains('dark')? 'dark':'light',
        style: '1',
        locale: 'tr',
        toolbar_bg: 'transparent',
        enable_publishing: false,
        hide_side_toolbar: false,
        allow_symbol_change: true,
        container_id: 'tradingview_widget'
      });
    }

    function startAutoRefresh(){
      if(intervalTimer) clearInterval(intervalTimer);
      countdown = 10;
      updateCountdownEl.textContent = `${countdown}s`;
      intervalTimer = setInterval(() =>{
        countdown--; updateCountdownEl.textContent = `${countdown}s`;
        if(countdown<=0){ countdown = 10; fetchMarkets(); }
      }, 1000);
    }

    // Events
    document.getElementById('themeToggle').addEventListener('click',()=>{
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark? 'dark':'light');
      // refresh TV theme
      if(!document.getElementById('tvWrap').classList.contains('hidden')){
        loadTradingView(document.getElementById('chartCoin').value);
      }
    });

    document.getElementById('manualRefresh').addEventListener('click',()=> fetchMarkets());
    searchInput?.addEventListener('input',()=> fetchMarkets());
    clearBtn?.addEventListener('click',()=>{ searchInput.value=''; fetchMarkets(); });
    document.getElementById('chartCoin').addEventListener('change', (e)=> updateChart(e.target.value, document.getElementById('daysSelect').value));
    document.getElementById('daysSelect').addEventListener('change', (e)=> updateChart(document.getElementById('chartCoin').value, e.target.value));

    // Chart mode toggles
    document.getElementById('chartModeJS').addEventListener('click', ()=>{
      document.getElementById('chartJsWrap').classList.remove('hidden');
      document.getElementById('tvWrap').classList.add('hidden');
    });
    document.getElementById('chartModeTV').addEventListener('click', ()=>{
      document.getElementById('tvWrap').classList.remove('hidden');
      document.getElementById('chartJsWrap').classList.add('hidden');
      loadTradingView(document.getElementById('chartCoin').value);
    });

    // Init
    document.getElementById('year').textContent = new Date().getFullYear();
    fetchMarkets().catch(err=>{
      console.error(err);
      lastUpdatedEl.textContent = 'Veri alınamadı. Daha sonra tekrar deneyin.';
    });
    startAutoRefresh();
  </script>
</body>
</html>
